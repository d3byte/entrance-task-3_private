# Приложение для создания и редактирования информации о встречах сотрудников

Написано для Node.js 8 и использует библиотеки:
* express
* sequelize
* graphql

## Задание
Код содержит ошибки разной степени критичности. Некоторых из них стилистические, а некоторые даже не позволят вам запустить приложение. Вам необходимо найти и исправить их.

Пункты для самопроверки:
1. Приложение должно успешно запускаться
2. Должно открываться GraphQL IDE - http://localhost:3000/graphql/
3. Все запросы на получение или изменения данных через graphql должны работать корректно. Все возможные запросы можно посмотреть в вкладке Docs в GraphQL IDE или в схеме (typeDefs.js)
4. Не должно быть лишнего кода
5. Все должно быть в едином codestyle

## Запуск
```
npm i
npm run dev
```

Для сброса данных в базе:
```
npm run reset-db
```
## Ход работы
1. Ошибка с Sequalize

При запуске приложения выводится какая-то ошибка, которая непонятно откуда исходит. Из логов видно, что она исходит из модуля sequalize. Первое, что приходит в голову - пакет был установлен с ошибкой, поэтому сношу node_modules и устанавливаю всё заново. После этого убеждаюсь, что ошибка где-то в коде, и начинаю искать файлы, где этот модуль используется. Попал на models/index.js. На первый взгляд, всё выглядит правильно. Однако в консоли выводится, что нужно обязательно указывать dialect в функции Sequalize. Так как объект с диалектом передаётся в конструктор, но получается, что его не обрабатывают, я решаю заглянуть в документацию Sequalize и посмотреть возможные проблемы: может аргументы идут не в том порядке или что-то пропущено. Так и оказалось, был пропущен один обязательный аргумент, из-за которого приложение и не запускалось. Добавляю его, и всё работает.

2. Убедился, что Graphql IDE открывается при рауте /graphql/, поставив в файле graphql/routes.js значение graphql: true
````javascript
router.use(graphqlHTTP({
  schema: schema,
  graphiql: true,
}));
````
Так же исправив ошибку в названии раута в index.js:
````javascript
app.use('/graphql', graphqlRoutes);
````
3. Начал тестировать запросы

При попытке получения events выводилась ошибка, что аргументы не обозначены, хотя по умолчанию они должны быть пустыми, если проводить аналогию с другими запросами. Убрал непонятно откуда взявшуюся переменную "argumets" и поставил пустой объект вместо неё:
````javascript
events (root, args, context) {
    return models.Event.findAll({}, context);
}
````
Теперь ошибка пропала, и я могу получить все эвенты.

4. Запрос rooms

Я не уверен, что это ошибка, но из-за выставленного offset-а пропускалась одна комната с названием <i>"404"</i>,
но так как это реальная комната, которая вмещает 5 человек, я решил убрать оффсет из запроса.
````javascript
rooms (root, args, context) {
    return models.Room.findAll({}, context);
} 
````
5. Получение инфы по эвентам

Grapql не хочет подхватывать инфу, полученную глубоким поиском, о юзерах и комнате. Очень долго шарил по коду и пытался манипулировать обработчиками мутаций и запросов, но оказалось, что шарил недостаточно внимательно. Ошибка затаилась в функциях, отвечающих за обработку этих самых полей. Нужно было изменить их так:
````javascript
Event: {
    room(event) {
        return event.getRoom();
    },
    users (event) {
        return event.getUsers();
    },
},
````
Был пропущен return, значит функции ничего не возвращали.

6. Смена комнаты эвента

Ошибка заключалась в том, что эвенту присваивалась комната с айди эвента. Теперь код выглядит так:
````javascript
changeEventRoom (root, { id, roomId }, context) {
    return models.Event.findById(id)
            .then(event => {
            event.setRoom(roomId);
            });
}
````